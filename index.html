<!DOCTYPE html>
<html>
<head>
<title>Arduino LED Matrix Control (BLE)</title>
<style>
/* ... (existing styles are correct) ... */
</style>
</head>
<body>
<h1>Arduino LED Matrix Control (BLE)</h1>
<div class="controls">
  <button id="connectButton" onclick="connect()">Connect to Arduino</button>
  <span id="connectionStatus">Disconnected</span>
</div>
<div class="controls">
  <button onclick="clearMatrix()">Clear</button>
  <button onclick="loadPreset('S')">Smile</button>
  <button onclick="loadPreset('H')">Heart</button>
  <button onclick="loadPreset('PurdueP')">Purdue P</button>
</div>
<div id="matrix"></div>
<div class="footer-content">
  <h2>Lesson Ideas</h2>
  <p>
    This project can be used in a variety of educational settings.
    Students can learn about:
    <ul>
      <li>Bluetooth Low Energy (BLE) services and characteristics</li>
      <li>Binary representation (each LED is a bit)</li>
      <li>Web Bluetooth API for hardware communication</li>
      <li>Hardware-software interaction</li>
    </ul>
  </p>
  <p>
    Have students design their own images and translate them into a C++ array.
    They can also modify the web interface to add new features or a custom layout.
  </p>
  <p>&copy; 2025 Arduino LED Matrix Project. All rights reserved. Purdue University and its logos are trademarks of Purdue University.</p>
</div>
<script>
const SERVICE_UUID = "19b10000-e8f2-537e-4f6c-d104768a1214";
const CHARACTERISTIC_UUID = "19b10001-e8f2-537e-4f6c-d104768a1214";

let device, characteristic;

document.addEventListener('DOMContentLoaded', () => {
  const matrix = document.getElementById('matrix');

  for (let y = 0; y < 8; y++) {
    for (let x = 0; x < 12; x++) {
      const led = document.createElement('div');
      led.className = 'led';
      led.dataset.x = x;
      led.dataset.y = y;
      led.addEventListener('click', () => toggleLed(x, y, led));
      matrix.appendChild(led);
    }
  }
});

async function connect() {
  try {
    document.getElementById('connectionStatus').textContent = "Connecting...";
    device = await navigator.bluetooth.requestDevice({
      filters: [{ name: 'UNO R4 LED Matrix' }],
      optionalServices: [SERVICE_UUID]
    });

    const server = await device.gatt.connect();
    const service = await server.getPrimaryService(SERVICE_UUID);
    characteristic = await service.getCharacteristic(CHARACTERISTIC_UUID);

    document.getElementById('connectionStatus').textContent = "Connected!";
    console.log("Connected to device:", device.name);

  } catch (error) {
    document.getElementById('connectionStatus').textContent = "Connection Failed";
    console.error('Connection error:', error);
  }
}

function writeValue(value) {
  if (!characteristic) {
    alert("Not connected to Arduino! Please click the 'Connect' button.");
    return;
  }
  const encoder = new TextEncoder();
  characteristic.writeValue(encoder.encode(value))
    .catch(error => console.error('Write error:', error));
}

function toggleLed(x, y, ledElement) {
  ledElement.classList.toggle('on');
  writeValue(`P${x},${y}`);
}

function clearMatrix() {
  document.querySelectorAll('.led').forEach(led => led.classList.remove('on'));
  writeValue("C");
}

function loadPreset(presetCode) {
  writeValue(presetCode);
  const presetFrames = {
    'S': [
      [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
      [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
      [0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0],
      [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
      [0, 0, 0, 1, 1, 1, 1, 1, 0, 0, 0, 0],
      [0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0],
      [0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0],
      [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
    ],
    'H': [
      [0, 0, 1, 1, 0, 0, 0, 1, 1, 0, 0, 0],
      [0, 1, 0, 0, 1, 0, 1, 0, 0, 1, 0, 0],
      [0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0],
      [0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0],
      [0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0],
      [0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0],
      [0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0],
      [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
    ],
    'PurdueP': [
   [0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0],
    [0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0],
    [0, 1, 1, 0, 0, 1, 1, 1, 0, 0, 1, 0],
    [0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0],
    [0, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0],
    [1, 1, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0],
    [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0],
    [1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0]
    ]
  };
  const selectedFrame = presetFrames[presetCode];
  if (selectedFrame) {
    document.querySelectorAll('.led').forEach(led => {
      const x = parseInt(led.dataset.x);
      const y = parseInt(led.dataset.y);
      if (selectedFrame[y][x] === 1) {
        led.classList.add('on');
      } else {
        led.classList.remove('on');
      }
    });
  }
}
</script>
</body>
</html>
